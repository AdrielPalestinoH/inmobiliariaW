<div class="clientes-page p-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3><i class="bi bi-people"></i> Clientes</h3>
    <button class="btn btn-primary" (click)="nuevoClienteForm()">
      {{ mostrarFormulario ? 'Cerrar formulario' : 'Agregar Cliente' }}
    </button>
  </div>

  <!-- Formulario de alta / edición -->
  <div *ngIf="mostrarFormulario" class="card p-4 mb-4 shadow-sm">
    <h5 class="mb-3">
      {{ modoEdicion ? 'Editar Cliente' : 'Nuevo Cliente' }}
    </h5>

    <form (ngSubmit)="guardarCliente()" #f="ngForm">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Nombre</label>
          <input
            class="form-control"
            placeholder="Nombre"
            [(ngModel)]="clienteActual.nombre"
            name="nombre"
            required
          />
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Apellidos</label>
          <input
            class="form-control"
            placeholder="Apellidos"
            [(ngModel)]="clienteActual.apellidos"
            name="apellidos"
          />
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Email</label>
          <input
            type="email"
            class="form-control"
            placeholder="Email"
            [(ngModel)]="clienteActual.email"
            name="email"
            required
          />
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Teléfono</label>
          <input
            class="form-control"
            placeholder="Teléfono"
            [(ngModel)]="clienteActual.cel"
            name="cel"
          />
        </div>
      </div>

      <div class="d-flex justify-content-end gap-2 mt-3">
        <button
          class="btn btn-success"
          type="submit"
          [disabled]="f.invalid"
        >
          {{ modoEdicion ? 'Actualizar' : 'Guardar' }}
        </button>
        <button
          type="button"
          class="btn btn-secondary"
          (click)="mostrarFormulario = false"
        >
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <!-- Filtro de búsqueda -->
  <div class="card p-3 mb-3 shadow-sm">
    <div class="d-flex gap-2">
      <input
        class="form-control"
        placeholder="Buscar cliente por nombre, apellido o correo..."
        [(ngModel)]="filtro"
      />
      <button class="btn btn-outline-primary">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </div>

  <!-- Tabla de clientes -->
  <div class="table-responsive card shadow-sm">
    <table class="table table-striped align-middle mb-0">
      <thead class="table-primary text-center">
        <tr>
          <th style="width: 50px;">#</th>
          <th>Nombre</th>
          <th>Email</th>
          <th>Teléfono</th>
          <th>Tipo</th>
          <th style="width: 150px;">Acciones</th>
        </tr>
      </thead>
      <tbody class="text-center">
        <tr *ngFor="let c of buscar(); let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ c.nombre ?? '-' }} {{ c.apellidos ?? '' }}</td>
          <td>{{ c.email ?? '-' }}</td>
          <td>{{ c.cel ?? '-' }}</td>
          <td>{{ c.tipoUsuarioDescripcion ?? 'Cliente' }}</td>
          <td>
            <button
              class="btn btn-sm btn-outline-primary me-2"
              (click)="editarCliente(c)"
            >
              <i class="bi bi-pencil"></i> Editar
            </button>
          </td>
        </tr>

        <tr *ngIf="buscar().length === 0">
          <td colspan="6" class="text-muted py-3">No se encontraron clientes</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
